\documentclass[sigplan, screen, natbib=false]{acmart}
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
Bib\TeX}}}

%%% The following is specific to TyDe '25 and the paper
%%% 'The Conatural Numbers Form an Exponential Commutative Semiring'
%%% by Szumi Xie and Viktor Bense.
%%%
\setcopyright{cc}
\setcctype{by}
\acmDOI{10.1145/3759538.3759654}
\acmYear{2025}
\copyrightyear{2025}
\acmISBN{979-8-4007-2163-2/25/10}
\acmConference[TyDe '25]{Proceedings of the 10th ACM SIGPLAN International Workshop on Type-Driven Development}{October 12--18, 2025}{Singapore, Singapore}
\acmBooktitle{Proceedings of the 10th ACM SIGPLAN International Workshop on Type-Driven Development (TyDe '25), October 12--18, 2025, Singapore, Singapore}
\received{2025-06-23}
\received[accepted]{2025-07-23}

%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% For managing citations, it is recommended to use bibliography
%% files in BibTeX format.
%%
%% You can then either use BibTeX with the ACM-Reference-Format style,
%% or BibLaTeX with the acmnumeric or acmauthoryear sytles, that include
%% support for advanced citation of software artefact from the
%% biblatex-software package, also separately available on CTAN.
%%
%% Look at the sample-*-biblatex.tex files for templates showcasing
%% the biblatex styles.
%%

%%
%% The majority of ACM publications use numbered citations and
%% references, obtained by selecting the acmnumeric BibLaTeX style.
%% The acmauthoryear BibLaTeX style switches to the "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the acmauthoryear style of
%% citations and references.
%%
%% Bibliography style
\RequirePackage[
  datamodel=acmdatamodel,
  style=acmnumeric,
]{biblatex}

%% Declare bibliography sources (one \addbibresource command per source)
\addbibresource{references.bib}

\usepackage{latex/agda}
\usepackage{tikz}
\usetikzlibrary{calc,arrows.meta,decorations.pathreplacing}

\usepackage{newunicodechar}
\newunicodechar{∎}{\ensuremath{∎}}
\newunicodechar{∷}{\ensuremath{∷}}
\newunicodechar{≋}{\ensuremath{≋}}
\newunicodechar{∙}{\ensuremath{∙}}
\newunicodechar{↺}{\ensuremath{↺}}
\newunicodechar{ₗ}{\textsubscript{L}}
\newunicodechar{ᵣ}{\textsubscript{R}}
\newunicodechar{ᴺ}{\textsubscript{N}}
\newunicodechar{ᴱ}{\textsubscript{E}}
\newunicodechar{ᴾ}{\textsubscript{P}}

%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{The Conatural Numbers Form an Exponential Commutative Semiring}

%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.
\author{Szumi Xie}
\orcid{0009-0001-1355-1114}
\affiliation{%
  \institution{Eötvös Loránd University}
  \city{Budapest}
  \country{Hungary}
}
\email{szumi@inf.elte.hu}

\author{Viktor Bense}
\orcid{0009-0005-9325-5225}
\affiliation{%
  \institution{Eötvös Loránd University}
  \city{Budapest}
  \country{Hungary}
}
\email{bense.viktor@inf.elte.hu}

%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.
% \renewcommand{\shortauthors}{Trovato et al.}

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
\begin{abstract}
  Conatural numbers are a coinductive type dual to the inductively defined
  natural numbers. The conatural numbers can represent all natural numbers and
  an extra element for infinity, this can be useful for representing the amount
  of steps taken by a possibly non-terminating program. We can define functions
  on conatural numbers by corecursion, however proof assistants such as Agda
  require the corecursive definitions to be guarded to make sure that they are
  productive. This requirement is often too restrictive, as it disallows the
  corecursive occurrence to appear under previously defined operations. In this
  paper, we explore some methods to solving this issue using the running
  examples of multiplication and the commutativity of addition on conatural
  numbers, then we give comparisons between these methods. As the main result,
  this is the first proof that conatural numbers form an exponential commutative
  semiring in cubical type theory without major extensions.
\end{abstract}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.
%%
\begin{CCSXML}
<ccs2012>
   <concept>
       <concept_id>10003752.10003790.10011740</concept_id>
       <concept_desc>Theory of computation~Type theory</concept_desc>
       <concept_significance>500</concept_significance>
       </concept>
   <concept>
       <concept_id>10003752.10003790.10002990</concept_id>
       <concept_desc>Theory of computation~Logic and verification</concept_desc>
       <concept_significance>500</concept_significance>
       </concept>
   <concept>
       <concept_id>10003752.10003790.10003796</concept_id>
       <concept_desc>Theory of computation~Constructive mathematics</concept_desc>
       <concept_significance>500</concept_significance>
       </concept>
   <concept>
       <concept_id>10003752.10010124.10010138.10010142</concept_id>
       <concept_desc>Theory of computation~Program verification</concept_desc>
       <concept_significance>500</concept_significance>
       </concept>
   <concept>
       <concept_id>10011007.10011006.10011008.10011024.10011033</concept_id>
       <concept_desc>Software and its engineering~Recursion</concept_desc>
       <concept_significance>100</concept_significance>
       </concept>
   <concept>
       <concept_id>10011007.10011006.10011008.10011024.10011028</concept_id>
       <concept_desc>Software and its engineering~Data types and structures</concept_desc>
       <concept_significance>100</concept_significance>
       </concept>
 </ccs2012>
\end{CCSXML}

\ccsdesc[500]{Theory of computation~Type theory}
\ccsdesc[500]{Theory of computation~Logic and verification}
\ccsdesc[500]{Theory of computation~Constructive mathematics}
\ccsdesc[500]{Theory of computation~Program verification}
\ccsdesc[100]{Software and its engineering~Recursion}
\ccsdesc[100]{Software and its engineering~Data types and structures}

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.
\keywords{%
  conatural number, corecursion, coinduction, productivity, guardedness,
  termination, semiring, cubical type theory, univalence
}
%% A "teaser" image appears between the author and affiliation
%% information and the body of the document, and typically spans the
%% page.
% \begin{teaserfigure}
%   \includegraphics[width=\textwidth]{sampleteaser}
%   \caption{Seattle Mariners at Spring Training, 2010.}
%   \Description{Enjoying the baseball game from the third-base
%   seats. Ichiro Suzuki preparing to bat.}
%   \label{fig:teaser}
% \end{teaserfigure}

% \received{20 February 2007}
% \received[revised]{12 March 2009}
% \received[accepted]{5 June 2009}

%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

\section{Introduction}\label{sec:intro}
\input{latex/Introduction}

\section{Naïve Corecursion}\label{sec:problem}
\input{latex/Problem}

% Temintation checking error

\section{Direct Corecusion}\label{sec:direct}
\input{latex/Direct}

% Proving everything directly
% using complicated states

\section{The Embedded Languages Approach}\label{sec:dsl}
\input{latex/CompBisim}

% Compositionality
% Nils' method: Define a DSL to make corecursion guarded.

\section{A Quotiented Embedded Language}\label{sec:quotiented}
\input{latex/Quotiented}

% Mixed inductive and coinductive type
% Make use of cubical agda's possibility to put proofs in data.

\section{Conclusion}

We studied three methods of reasoning about coinductive types to circumvent the
guardedness issue in Agda. We used cubical type theory because reasoning about
coinductive types is simpler. The third method in Section~\ref{sec:quotiented}
is the one where we successfully formalised that conatural numbers form an
exponential commutative semiring. To conclude, we give a short comparison
between the methods.

In Section~\ref{sec:direct} we directly used corecursion with specific internal
states. Using this method, we did not have to consider creating an intermediate
language. However, for every operation and proof we have to come up with a new
state that can accurately describe the predecessor as the step of the proofs.
% Use this method if you are a masochist.

In Section~\ref{sec:dsl-mul} we followed Danielsson's
method~\cite{danielsson-beating} and created a domain speific language to define
the multiplication operation and later in Section~\ref{sec:dsl-comm} we defined
a language for proofs to obtain equational reasoning. The problem is we have to
define a new language for every new operation we want in which we have to
include every operation we want to reuse as a constructor in order to make Agda
see the definition as guarded which quickly leads to code duplication.

In Section~\ref{sec:quotiented} we extended our language using the idea that we
can include equations themselves using a mixed higher-inductive\slash
coinductive definition, which is only allowed in Cubical Agda. This method
allows us to reuse any other algebraic operation and equation that we are
defining at the same time. With it, we easily proved that conatural numbers form
an exponential commutative semiring, showcasing an application of the univalence
principle. The only problem with this method is that it is not modular. If we
want to include more operations or properties that we define and proofs, then we
have to extend the already existing datatype of expressions.

We believe the last method can be generalised to definitions and proofs about
other coinductive types, so that one can easily reason about infinite programs.

\section{Future Work}

Some questions remain as future work. The method in Section~\ref{sec:dsl} can
introduce code duplication, while the method in Section~\ref{sec:quotiented} is
not modular. We wish to find a modular method of doing corecursion that is as
convenient as these, where one can reuse other operations and equations, but
does not necessitate code duplication.

Another question is how one can define some more complicated operations, such as
tetration or the Ackermann function, on conatural numbers. Since conatural
numbers are a coinductive type, one defines operations by specifying the
predecessor, however, it is not clear how one can specify the predecessors of
the aforementioned operations.

Lastly, in Section~\ref{sec:quotiented}, we used a mixed higher-inductive\slash
coinductive definition to specify the language of expressions, though it is not
clear what its semantic justification is, even though Agda supports it. Unlike
mixed inductive\slash coinductive types~\cite{ghani-stream}, we cannot directly
write it as the terminal coalgebra of some functor. If we were to parametrise
\AgdaDatatype{Expr} with \AgdaRecord{NExpr} and \AgdaField{pred}, then we would
have $\AgdaField{pred} : \AgdaDatatype{Maybe}\ (\AgdaDatatype{Expr}\
\AgdaRecord{NExpr}\ \AgdaField{pred})$, where the type of \AgdaField{pred}
depends on itself.

%%
%% The acknowledgments section is defined using the "acks" environment
%% (and NOT an unnumbered section). This ensures the proper
%% identification of the section in the article metadata, and the
%% consistent spelling of the heading.
\begin{acks}
  We thank the anonymous reviewers for their comments and suggestions, and
  Thorsten Altenkirch for originally posing this problem to us as a challenge.

  This work was co-funded by the European Union (ERC, HOTT, 101170308). Views
  and opinions expressed are however those of the author(s) only and do not
  necessarily reflect those of the European Union or the European Research
  Council. Neither the European Union nor the granting authority can be held
  responsible for them.
\end{acks}

%%
%% Print the bibliography
%%
\printbibliography

\end{document}
\endinput
